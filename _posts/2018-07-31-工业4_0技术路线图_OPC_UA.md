---
layout: post
title: "工业4.0技术路线图 - OPC UA"
categories: "工业4.0", "OPC UA"
description: "工业4.0技术路线图 - OPC UA"
keywords: "工业4.0", "OPC UA"
date: 2018-07-31 09:20:48
---

![image](/images/blog/工业4.0技术路线图-OPC-UA/image001.jpg)

工业4.0已成为近两年科技领域及财经领域的热门词汇，它是德国人根据自身的工业基础、生产经验以及已有的科技手段所总结出的一套最佳实践（Best - Practice）理论体系。

工业4.0概念源于德国联邦教育部与联邦经济技术部的一份报告，该报告中提出了一种崭新的“智能制造”模式，从而更加有效的整合生产过程中的资源，并更加快速的适应来自市场的生产需求。

在提出工业4.0概念的同时，报告中也对构建智能工厂的方法进行了阐述：
- 通过信息化技术与自动化技术的结合，构建深度整合的数字化工厂；
- 将射频技术应用于物料管理、配件装载，生产追溯等环节，形成智能化的物流与生产周期管理体系；
- 通过设备间的互联，提高设备间的相互协同能力，从而使生产模块间的搭配方式更灵活、更自由；
- 利用机器视觉，人工智能等技术，使机器人与设备具备更加智能化的功能；
- 通过对能源与物料消耗情况的监测与分析，得出节能降耗方案，打造绿色工厂。

![image](/images/blog/工业4.0技术路线图-OPC-UA/image002.jpg)

构建智能工厂是一项复杂的工程，它不但涉及到众多专业领域（机械，电子，自动化，IT），同时涵盖了多种应用技术（信息技术，感知技术，控制器，人工智能等）。

由于该系统的复杂性，业界在很长一段时间内都无法对其进行系统化的定义，而工业4.0的出现则通过对生产体系中要素的剖析以及对共性的总结，提出了一套完整而标准的概念体系：物理信息系统与物联网平台。

## 物理信息系统（Cyber - Physical System）

![image](/images/blog/工业4.0技术路线图-OPC-UA/image003.jpg)
  
物理信息系统Cyber - Physical System（CPS）由一系列符合CPS特性与原则的CPS节点（CPS Node）组成。在具体的应用中，CPS节点对应的是生产体系中的各类设备，如PLC、机械手、RFID读写器、传感器与摄像头等。

每个CPS节点通常需要具备CPS二元属性，且需要遵循CPS两项原则：
- 物理属性：具备与物理世界对接的能力，如传感，感知与控制等；
- 信息属性：涵盖一系列信息化手段，如数据管理，逻辑处理及网络通讯等；
- 去中心化原则：原则要求CPS中的每个节点作为独立的运行个体，独立的管理自身的硬件、数据、计算逻辑与网络通讯，而无需依赖于第三方系统；
- 可交互性原则：原则要求CPS节点必须以标准化及网络化的方式，实时、可靠、安全的与其他设备或系统进行通讯。

下表对CPS的一些应用场景进行描述

![image](/images/blog/工业4.0技术路线图-OPC-UA/image004.jpg)
 
下表对一些不满足两项基本原则的设备进行阐述

![image](/images/blog/工业4.0技术路线图-OPC-UA/image005.jpg)

## 物联网平台（Internet of Things Platform） 

![image](/images/blog/工业4.0技术路线图-OPC-UA/image006.jpg) 
 
CPS系统主要负责工业现场层面的具体任务，因此它无法满足企业管理层面的需求。在此背景下，工业4.0在CPS体系之上引入了物联网平台系统作为CPS系统的有效补充。

物联网平台系统在国内又称为两化融合系统，它是以监控、管理与业务为导向的信息化系统。该套系统主要具有以下特性：

- 集中监控：与生产中各环节（生产，库存，能耗等）底层设备进行通讯，并将它们的数据进行集中管理、实时监控和统一分析；
- 信息化及SOA：将晦涩的感知信号变为简单易懂的数据；将具体的控制指令转化为直观的操作方法；将零散的过程化数据汇总为有价值的业务信息；
- 大数据：作为工业大数据中的数据仓库层，负责将监控信息，生产追溯信息与业务信息进行存档与汇总，并对外提供历史查询服务及简单的数据分析服务。
- 标准而完整的服务：实时数据服务，历史查询与分析服务，事件与报警服务，事务与操作服务，会话与审计等；
- 高度可定制化：根据应用场景的不同，灵活的定制信息模型与业务模型。

物联网系统应用范围广泛，通常情况下，与现场设备相关的应用场景均可使用，以下是几个典型的应用场景：
 
![image](/images/blog/工业4.0技术路线图-OPC-UA/image007.jpg)

## 工业4.0中的智能工厂
  
![image](/images/blog/工业4.0技术路线图-OPC-UA/image008.jpg)

随着工业4.0概念的提出以及工业4.0技术的逐渐成熟，我们将看到越来越多有别于传统自动化工厂的应用模式。

![image](/images/blog/工业4.0技术路线图-OPC-UA/image009.jpg)
 
在CPS体系中，执行设备+感知设备的组合模式将得到广泛应用：RFID+PLC，传感器+PLC等组合将使工厂的定制化生产成为可能；而RFID的普及将大幅提高库存管理的自动化程度，并增强生产环节的可追溯能力；

在物联网体系中，SCADA、MES、EMS和WMS系统间的界限与层级将越来越模糊：SCADA系统的功能将向上延伸（更丰富的业务处理能力及数据管理能力）；MES、EMS、WMS系统将向下扩展（具备更多与底层设备进行通讯的能力）；伴随着彼此之间的渗透与融合，工业物联网平台将逐渐形成，并凭借其标准而灵活的架构，方案可定制化程度高等优势，将传统系统取而代之。
 
![image](/images/blog/工业4.0技术路线图-OPC-UA/image010.jpg)

关于工业4.0趋势的阐述并非虚无缥缈，因为它不但是西方学术界所共同总结出的最佳实践理论体系，而且也是业界领军者们根据自身利益与产品定位所达成的普遍共识。因此早在工业4.0概念推出之前，这些巨头们已经在着手进行相关的知识与技术储备，并于近几年内逐步推出自己的产品和解决方案。

当前，中国的生产模式依然处于较为粗放的阶段，与西方发达国家仍存在着较大的差距。作为后来者与跟随者，学习与效仿西方先进理念与技术无疑是缩小差距的最佳途径；因此笔者想通过本文，为大家介绍一个国内尚未被广泛认知，而西方工业领军者们已经开始广泛采纳的技术路线 - OPC UA。

## OPC UA - 工业4.0技术路线图
 
![image](/images/blog/工业4.0技术路线图-OPC-UA/image011.jpg)
  
OPC UA又称为OPC统一架构，它是一套集信息模型定义，服务集与通讯标准为一体的标准化技术框架。OPC UA规范由OPC基金会主导制定，并由多家厂商参与技术层面的设计、开发与产品化。

OPC UA架构的目的在于为行业内的软、硬件厂商和集成商提供一套指导性的技术路线图，从而帮助它们无缝的融入到工业4.0中的各个体系当中：

对于构建智能工厂的解决方案提供商而言，OPC UA是一套标准化、便于整合的产品家族，该套产品体系遍布于智能工厂的CPS系统和物联网系统，并能够满足以下几点需求：

![image](/images/blog/工业4.0技术路线图-OPC-UA/image012.jpg)  
 
对于CPS设备或物联网信息系统的开发者，OPC UA是一套符合OPC UA规范的实时数据中间件开发框架，其特点如下：

![image](/images/blog/工业4.0技术路线图-OPC-UA/image013.jpg)
 
## PC UA架构简介

![image](/images/blog/工业4.0技术路线图-OPC-UA/image014.jpg)

PC UA是一个Client/Server架构的实时数据库框架，UA Server负责管理自身的数据与处理逻辑，并通过OPC UA通讯协议对UA Client程序提供相应的数据与服务。

UA Server是基于OPC UA 服务器框架(UA Server SDK) 二次开发而生成的服务端程序，该程序即可以是CPS体系中的CPS设备： PLC, RFID Reader或传感器，也可以是物联网体系中的应用平台：MES，SCADA，EMS, WMS等。

UA Client负责与UA Server进行通讯，并访问UA Server中的数据与服务。由UAClient 开发的程序可以是界面应用（HMI、报表和报警中心），企业管理与决策平台（ERP和大数据平台），物联网系统（与CPS设备进行通讯的MES或SCADA）或是CPS设备（与RFID Reader进行协同的PLC）。

**OPC UA Server三层结构 - 数据层，服务层与通讯层**

![image](/images/blog/工业4.0技术路线图-OPC-UA/image016.jpg)
 
OPC UA的数据层又称地址空间（Address Space），它是由一系列拥有具体含义的内存数据与持久数据所组成的数据集合。地址空间采用面向对象的思想进行设计，由于其数据组织方式灵活自由，因此能够对工业现场数据，业务数据，历史数据，事件，报警，事务和信息模型进行统一管理与描述。

![image](/images/blog/工业4.0技术路线图-OPC-UA/image017.jpg)

OPC UA服务层介于数据层与通讯层之间，负责处理指定的交互任务。

![image](/images/blog/工业4.0技术路线图-OPC-UA/image018.jpg)

OPC UA的通讯层又称UA 协议栈(UA Stack)，其特点如下：
- 安全通道：负责对UA Client与UA Server的通讯数据进行加密与解密；
- 多种传输格式：支持二进制和 HTTP 数据传输，其中采用 HTTP 格式的数据具有防火墙友好的特性；
-  多传输方式：目前支持TCP通讯，将来会支持UDP通讯。

**如何使用OPC UA**

OPC UA是一项由浅入深的技术，针对不同需求的OPC UA使用者，其所需掌握的知识深度与技能的种类也有所不同。

![image](/images/blog/工业4.0技术路线图-OPC-UA/image019.jpg)

![image](/images/blog/工业4.0技术路线图-OPC-UA/image020.jpg)

![image](/images/blog/工业4.0技术路线图-OPC-UA/image021.jpg)
 
**OPC UA Server产品开发建议**

开发UA Server产品是一项复杂的工程，因此笔者根据自身的开发经验，在架构层面进行了一些总结，以供参考。

![image](/images/blog/工业4.0技术路线图-OPC-UA/image022.jpg)

嵌入式UA Server:
- 物理交互层：用于与设备的物理层进行通讯，负责将上行物理信号转换为OPC UA 格式，将下行数据转换为物理控制信号；
- 逻辑计算层：对采集数据及中间数据进行实时分析，对控制逻辑进行处理；
- 应用模型：根据现场设备特性所定义的设备模型及相应的逻辑计算模型。

![image](/images/blog/工业4.0技术路线图-OPC-UA/image024.jpg)

物联网平台UA Server：
- 设备通讯层：与现场多个且不同种类的设备进行通讯，负责数据的采集，命令的下发，通讯链路的维护以及通讯协议的转换等；
- 业务处理层：将采集上来的信号变为简单易懂的数据；将所需执行的任务分解为具体的控制命令；将过程化的数据进行集中处理，形成有价值的业务导向信息；
- 应用模型：根据现场设备特性定义的设备模型，以及以服务为导向的业务管理模型；
- 配置管理：负责在地址空间中动态的创建设备通讯实例和业务处理实例；
- 历史管理：负责记录程序运行过程中的设备数据与业务数据，并对外提供查询服务。

OPC UA生态系统：

![image](/images/blog/工业4.0技术路线图-OPC-UA/image026.jpg)

OPC UA应用案例

![image](/images/blog/工业4.0技术路线图-OPC-UA/image028.jpg)
 
**结束语**

OPC UA是一项汇集了业界专家常年实践经验的产物，无论是总体的设计思想，还是具体的技术细节，都能让我们感受到OPC UA所凝聚的匠人精神。

学习OPC UA 是一个自我提升，自我修炼的过程：通过对OPC UA的学习，我们能从中汲取到宝贵的知识与经验；通过使用 OPC UA，我们能够站在巨人的肩膀上，站得更高，看的更远。

作为OPC UA忠实的粉丝，笔者希望借此文章让更多的人接触与理解OPC UA，并希望在不久的将来，国内市场上能出现更多国人自己的OPC UA产品及解决方案。
